<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Document Scanner</title>
<style>
  body { font-family:'Sarabun', sans-serif; background:#f5f5f5; margin:0; padding:20px; text-align:center;}
  h2 { color:#06C755; }
  input, button { padding:10px 20px; margin:10px; font-size:16px; border-radius:6px; }
  #previewContainer { display:flex; flex-wrap:wrap; justify-content:center; gap:10px; margin-top:20px;}
  .pageCanvas { border:1px solid #555; border-radius:8px; max-width:160px; }
  .btn { background:#06C755; color:#fff; border:none; cursor:pointer; transition:.3s;}
  .btn:hover { background:#049645; }
</style>
</head>
<body>

<h2>üìÑ Smart Document Scanner</h2>
<p>‡∏ñ‡πà‡∏≤‡∏¢‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏´‡∏•‡∏≤‡∏¢‡∏´‡∏ô‡πâ‡∏≤ ‚Üí ‡∏Ñ‡∏£‡∏≠‡∏õ‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞ ‚Üí ‡∏û‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</p>

<input type="file" id="cameraInput" accept="image/*" capture="environment" multiple>
<br>
<button class="btn" onclick="exportPDF()">Export PDF</button>
<div id="previewContainer"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
const { jsPDF } = window.jspdf;
let pagesArray = [];

document.getElementById('cameraInput').addEventListener('change', async e=>{
  const files = Array.from(e.target.files);
  for(const file of files){
    const img = new Image();
    img.src = URL.createObjectURL(file);
    await img.decode();
    const canvas = document.createElement('canvas');
    canvas.width = img.width;
    canvas.height = img.height;
    const ctx = canvas.getContext('2d');
    ctx.drawImage(img,0,0,img.width,img.height);

    // Smart Crop (‡∏á‡πà‡∏≤‡∏¢ ‡πÜ) - detect edges by brightness threshold
    const imageData = ctx.getImageData(0,0,canvas.width,canvas.height);
    const data = imageData.data;
    let minX=canvas.width, minY=canvas.height, maxX=0, maxY=0;
    for(let y=0;y<canvas.height;y++){
      for(let x=0;x<canvas.width;x++){
        const i = (y*canvas.width+x)*4;
        const r=data[i], g=data[i+1], b=data[i+2];
        const brightness = (r+g+b)/3;
        if(brightness<200){ // threshold
          if(x<minX) minX=x; if(x>maxX) maxX=x;
          if(y<minY) minY=y; if(y>maxY) maxY=y;
        }
      }
    }
    if(maxX>minX && maxY>minY){
      const w=maxX-minX;
      const h=maxY-minY;
      const croppedCanvas = document.createElement('canvas');
      croppedCanvas.width = w;
      croppedCanvas.height = h;
      const croppedCtx = croppedCanvas.getContext('2d');
      croppedCtx.drawImage(canvas, minX, minY, w, h, 0, 0, w, h);

      // Preview
      croppedCanvas.classList.add('pageCanvas');
      document.getElementById('previewContainer').appendChild(croppedCanvas);
      pagesArray.push(croppedCanvas); // ‡πÄ‡∏Å‡πá‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏ß‡πâ export
    }
  }
});

function exportPDF(){
  if(pagesArray.length===0){ alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡πâ Export"); return; }
  const pdf = new jsPDF();
  pagesArray.forEach((c,i)=>{
    if(i>0) pdf.addPage();
    const imgData = c.toDataURL('image/jpeg',1.0);
    pdf.addImage(imgData,'JPEG',0,0,pdf.internal.pageSize.getWidth(), pdf.internal.pageSize.getHeight());
  });
  pdf.save('scanned_document.pdf');
}
</script>
</body>
</html>
